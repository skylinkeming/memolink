<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .highlight-toolbar {
        display: flex;
        justify-content: center;
        align-items: center;
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        padding: 4px;
        display: flex;
        gap: 4px;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        z-index: 999999;
      }
      #colorBtn {
        width: 20px;
        height: 20px;
        background: yellow;
      }
    </style>
  </head>
  <body>
    <script>
      let selectedObj = null;
      let currentRange = null;
      let toolbar = null;

      //綁定滑鼠放開事件
      document.addEventListener("mouseup", () => {
        console.log("mouse up");

        selectedObj = window.getSelection();
        if (!selectedObj.isCollapsed) {
          currentRange = selectedObj.getRangeAt(0);
          showToolbar(currentRange);
        }
      });

      function showToolbar(range) {
        toolbar = document.createElement("div");
        toolbar.className = "highlight-toolbar";
        toolbar.innerHTML = `
                <div id="colorBtn"></div>
                <div id="noteBtn"></div>
            `;
        //定位
        const rect = range.getBoundingClientRect();
        toolbar.style.top = `${window.scrollY + rect.top - 40}px`;
        toolbar.style.left = `${window.scrollX + rect.left}px`;

        document.body.appendChild(toolbar);

        //綁定點擊事件
        document.querySelector("#colorBtn").addEventListener("click", () => {
          debugger;
          applyColor();
        });
      }

      function applyColor() {
        if (!currentRange) return;

        // 創建一個新的 span 節點
        const span = document.createElement("span");
        span.style.backgroundColor = "yellow"; // 設置背景顏色
        span.textContent = selectedObj.toString(); // 設置選取的文字

        // 刪除選取範圍的內容，並插入新的 span 節點
        currentRange.deleteContents();
        currentRange.insertNode(span);

        // 清除選取範圍
        window.getSelection().removeAllRanges();
      }
    </script>

    Chapter 1: What Is JavaScript? You don't know JS, yet. Neither do I, not
    fully anyway. None of us do. But we can all start getting to know JS better.
    In this first chapter of the first book of the You Don't Know JS Yet
    (YDKJSY) series, we will take some time to build a foundation to move
    forward on. We need to start by covering a variety of important background
    housekeeping details, clearing up some myths and misconceptions about what
    the language really is (and isn't!). This is valuable insight into the
    identity and process of how JS is organized and maintained; all JS
    developers should understand it. If you want to get to know JS, this is how
    to get started taking the first steps in that journey.
  </body>
</html>
